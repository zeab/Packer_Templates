{
	"_comment": "Build with `packer build ap-3.6-64x-base.json`",

	"variables": {
		"_comment": 								"General Settings",
		"vm_version":									"1.0.0",
		"vm_name":										"ap-3.6-64x",
		"vm_flavor":									"base",
		
		"_comment": 								"Packer Settings",
		"pack_headless": 								"false",
		"shutdown_command": 							"sudo -S shutdown -P now",
		"post_shutdown_delay":	 						"1m",
		
		"_comment":			 						"Hypervisor Settings",
		"disk_size": 									"15360",
		"cpus": 										"2",
		"memory": 										"2048",
		"vram":											"64",
		"nictype1":										"virtio",
		"audio":										"none",
		
		"_comment": 								"Virtualbox Settings",
		"vbox_guest_os_type": 							"Linux26_64",
		"vbox_guest_additions_mode":					"upload",
		"vbox_clipboard":								"bidirectional",

		"_comment": 								"VMware Settings",
		"vmware_guest_os_type":							"",
		"vmware_guest_additions_mode":					"",
		
		"_comment": 								"Parallels Settings",
		"parallels_guest_os_type":						"",
		"parallels_guest_additions_mode":				"",
		
		"_comment": 								"Hyper-V Settings",
		"hyperv_guest_os_type":							"",
		"hyperv_guest_additions_mode":					"",
		
		"_comment": 								"OS Source Settings",
		"iso_name":										"alpine-standard-3.6.2-x86_64.iso",
		"iso_url": 										"http://dl-cdn.alpinelinux.org/alpine/v3.6/releases/x86_64",
		"iso_flavor":									"",
		"iso_alt_path": 								"",
		"iso_checksum_type": 							"sha256",
		"iso_checksum": 								"ddf8b91cc0d2b1c110f26607d410e5c951eedff9c60d6eb05d220b87c1970840",
		
		"_comment":					 				"OS Settings",
		"os_username": 									"vagrant",
		"os_password": 									"vagrant",
		"install_desktop":								"false",
		"install_updates":								"false",
		
		"_comment":			 						"OS Communication Settings",
		"os_comm_type":									"ssh",
		"os_comm_timeout":								"6h",
		
		"_comment": 								"Boot Commands/Settings",
		"os_config_path":								"./os_config_files",
		"os_config_file":								"preseed.cfg",
		"floppy_files_path":							"./floppy_files",
		"sftwre_install_script_path":					"./flavor",
		"sftwre_install_file":							"install-software.sh",

		"_comment": 								"Vagrant Settings",
		"configure_for_vagrant":						"true",
		"vgrt_output_path":								"./.box",
		"vgrt_compression":								"",
		"vgrtfile_template_path": 						"",
		"vgrtfile_template_file":						"",
		
		"_comment": 								"Atlas Settings",
		"atlas_token":									"",
		"atlas_username":								"",
		"atlas_artifact_type":							"",
		"atlas_provider1":								"",
		"atlas_provider2":								"",
		"atlas_provider3":								"",
		"atlas_description":							"",
		
		"_comment": 								"AWS Settings",
		"aws_access_key":								"",
		"aws_secret_key":								"",
		"aws_region":									"",
		"aws_s3_bucket_name":							"",

		"_comment": 								"Azure ARM Settings",
		"azure_client_id":								"",
		"azure_client_sectet":							"",
		"azure_resource_group_name":					"",
		"azure_storage_account":						"",
		"azure_tenant_id":								"",
		"azure_capture_container_name":					"",
		"azure_capture_name_prefix":					"",
		"azure_os_type":								"",
		"azure_image_publisher":						"",
		"azure_image_offer":							"",
		"azure_image_sku":								"",
		"azure_location":								"",
		"azure_vm_size":								"",
		"azure_tag":									""		
	},
	"builders": [
		{
			"type":                 					"virtualbox-iso",
			"guest_os_type":        					"{{user `vbox_guest_os_type`}}",
			"guest_additions_mode": 					"{{user `vbox_guest_additions_mode`}}",
	  
			"disk_size":            					"{{user `disk_size`}}",
			"vboxmanage": [
														["modifyvm", "{{.Name}}", "--nictype1", 	"{{user `nictype1`}}"],
														["modifyvm", "{{.Name}}", "--memory", 		"{{user `memory`}}"],
														["modifyvm", "{{.Name}}", "--cpus",     	"{{user `cpus`}}"],
														["modifyvm", "{{.Name}}", "--vram",     	"{{user `vram`}}"],
														["modifyvm", "{{.Name}}", "--audio",     	"{{user `audio`}}"]
				],
			
			"floppy_files": [
														"{{user `os_config_path`}}/{{user `os_config_file`}}",
														"{{user `floppy_files_path`}}/*.*",
														"{{user `floppy_files_path`}}/installers/*.*",
														"{{user `sftwre_install_script_path`}}/{{user `vm_flavor`}}/*.*"
				],		
			
			"headless":             					"{{user `pack_headless`}}",
			"shutdown_command": 						"echo '{{ user `os_password` }}'|{{user `shutdown_command`}}",
			"post_shutdown_delay" : 					"{{user `post_shutdown_delay`}}",

			"iso_urls": [
														"{{ user `iso_alt_path` }}/{{ user `iso_name` }}",
														"{{ user `iso_url` }}/{{user `iso_name`}}"
				],
			"iso_checksum_type":    					"{{user `iso_checksum_type`}}",
			"iso_checksum":         					"{{user `iso_checksum`}}",
		
			"communicator":			         			"{{user `os_comm_type`}}",
			"ssh_password": 			      			"{{user `os_username`}}",
			"ssh_username":			       				"{{user `os_password`}}",
			"ssh_wait_timeout": 			   			"{{user `os_comm_timeout`}}",
			
			"boot_command": [
														"root<enter><wait>",
														"setup-alpine<enter><wait>",
														"us<enter><wait>",
														"us<enter><wait>",
														"mineHostName<enter><wait>",
														"<enter><wait>",
														"<enter><wait>",
														"<enter><wait>",
														"no<enter><wait>",
														"vagrant<enter><wait>",
														"vagrant<enter><wait>",
														"<enter><wait>",
														"<enter><wait>",
														"f<enter><wait>",
														"<enter><wait>",
														"<enter><wait>",
														"sda<enter><wait>",
														"sys<enter><wait>",
														"y<enter><wait>",
														"reboot<enter><wait>"
														
				]
		}
	],
	"provisioners": [
		{
			"only": 									["virtualbox-iso"],
			"type": 									"shell",
			"execute_command": 							"echo '{{ user `os_password` }}' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
			"scripts": 									"{{user `floppy_files_path`}}/install-virtualbox-tools.sh",
			"pause_before": 							"30s"	
		},
		{
			"type": 									"shell",
			"environment_vars": [
														"OS_USERNAME={{user `os_username`}}",
														"OS_PASSWORD={{user `os_password`}}",
														"INSTALL_DESKTOP={{user `install_desktop`}}"
				],
			"execute_command": 							"echo '{{ user `os_password` }}' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
			"scripts": [
														"{{user `floppy_files_path`}}/install-desktop.sh",
														"{{user `floppy_files_path`}}/reboot.sh"
				],
			"pause_before": 							"30s"	
		},
		{
			"type": 									"shell",
			"environment_vars": [
														"OS_USERNAME={{user `os_username`}}",
														"OS_PASSWORD={{user `os_password`}}"
				],
			"execute_command": 							"echo '{{ user `os_password` }}' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
			"scripts": [
														"{{user `sftwre_install_script_path`}}/{{user `vm_flavor`}}/{{user `sftwre_install_file`}}",
														"{{user `floppy_files_path`}}/reboot.sh"
				],
			"pause_before": 							"30s"	
		},
		{
			"type": 									"shell",
			"environment_vars": [
														"OS_USERNAME={{user `os_username`}}",
														"OS_PASSWORD={{user `os_password`}}",
														"CONFIGURE_FOR_VAGRANT={{user `configure_for_vagrant`}}"
				],
			"execute_command": 							"echo '{{ user `os_password` }}' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
			"scripts": [
														"{{user `floppy_files_path`}}/configure-for-vagrant.sh",
														"{{user `floppy_files_path`}}/finalize-compact.sh"
				],
			"pause_before": 							"30s"	
		}
		
	],
	"post-processors": [
		{
			"type": 									"vagrant",
			"keep_input_artifact": 						false,
			"output": 									"{{user `vgrt_output_path`}}/{{.Provider}}/{{user `vm_name`}}-{{user `vm_flavor`}}.box",
			"vagrantfile_template": 					"{{user `vgrtfile_template_path`}}{{user `vgrtfile_template_file`}}"	
		}
	]
}